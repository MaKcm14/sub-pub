# Sub/Pub-service
Данный сервис является реализацией паттерна **Sub/Pub** (подписчик/издатель), написанного в рамках тестового задания стажировки VK.
<hr>
<hr>

## Описание
Задание состояло из двух частей:
1. Написание пакета `subpub` для локальной реализации паттерна
2. Написание самого сервиса, реализованного через механизм `GRPC`

<hr>

### Часть-1
Реализацию пакета данной части можно найти в папке `pkg`.

Основная суть работы данного пакета заключается в том, 
что базовой единицей, обеспечивающей работу пакета, выступает так называемая подписка, реализованная в `channelSub`. В основном её характеризует именно функция-обработчик, позволяющая в рамках текущей подписки клиента обрабатывать сообщения по-своему, и флаг активности подписки, отвечающий за состояние работы подписки (то есть нужно ли её вообще учитывать).

Каждый `subject` (в рамках реализации синонимом к нему выступает `channel`) отвечает за конкретную тематику, за конкретные именованные каналы и все подписки, которые были созданы на него.

`eventChannel` в реализации отвечает за основную логику работы с данными `subject`'ами и соответственно он и реализует интерфейс `SubPub`.

Для данного пакета были написаны `unit-тесты`, которые проверяют основную логику его работы: начиная с логики по проверке соблюдения порядка `FIFO` в очередях и заканчивая проверкой `negative cases`.

<hr>

### Часть-2
В данной части задания необходимо было реализовать сервис подписок на основе пакета `subpub`. Был предоставлен контракт `proto-файла`, на основе которого и обеспечивалось написание сервиса. Основная логика работы такова:

В сервисе обеспечивается реализация функций для публикации событий и для подписок на них.
При публикации вызывается удалённо метод `Publish`, который вызывает метод `Publish` пакета `subpub`.

В свою очередь, подписчики вызывают метод `Subscribe`, возвращающий `stream` для работы с сервисом: при очередном вызове `Publish` происходит вызов метода `handler`'а, 
который передаёт данные в канал, откуда они затем передаются в `stream` клиенту.

Согласно заданию сервис также обеспечивает хранение лог-информации о своей работе в папке `logs`. Также в сервисе предусмотрен файл конфигурации, в котором указывается сокет, на котором сервис будет ожидать клиентских соединений.

<hr>

## Как собирать?
Для упрощения развертывания сервиса используется `Docker`. Для того чтобы собрать сервис, необходимо проделать следующее:
1. `git clone https://github.com/MaKcm14/vk-test.git`
2. `docker compose build`
3. `docker compose up -d`

После чего будет поднят контейнер с приложением на сокете, указанном в файле конфигурации (см. пример файла `.env_example`).

### P.S.
- По умолчанию происходит проброс портов на хост.

- Также при изменении файла конфигурации необходимо будет скорректировать и данные в файле `docker-compose.yml` и `Dockerfile`.

<hr>

## Особенности реализации
